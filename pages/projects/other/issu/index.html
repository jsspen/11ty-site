<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preload" href="/styles.css" as="style" onload="this.rel='stylesheet'">
    <noscript>
      <link rel="stylesheet" href="/styles.css">
    </noscript>
    <link rel="stylesheet" href="/prism-vsc-dark-plus.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wdth,wght@8..144,25..151,100..1000&display=swap" rel="stylesheet">
    <title>ISSU Grabber</title>
  </head>
  <body>
    <h1>jordan spencer</h1>
    <header>
      <nav><a href="/pages/about">about</a> | <a href="/pages/projects">projects</a> | <a href="/pages/writing">writing</a> | <a href="/pages/resume">cv</a></nav>
    </header>
    
<article>
    <h1>ISSUU Grabber</h1>
<p><a href="https://github.com/jsspen/issuu-grabber">Github Repo</a></p>
<p>An interactive Python script to scrape, build, and save a PDF copy of any document hosted by ISSUU</p>
<p><strong>Ingredients:</strong> Python, File I/O, File Conversion, HTTP Requests, Web Scraping, BeautifulSoup, HTML Parsing</p>
<hr>
<h2>Basic usage</h2>
<ul>
<li>Clone or download repo</li>
<li>Open terminal in root directory</li>
<li>Run the program with <code>python issuu-grabber.py</code></li>
</ul>
<h3>Manual Entry</h3>
<p>Provide a single URL with the option to continue as many times as desired</p>
<ul>
<li>When prompted enter <code>u</code> for manual entry</li>
<li>Paste the full ISSUU URL into the terminal</li>
</ul>
<h3>File Entry</h3>
<p>Simple batch processing for a list of URLs</p>
<ul>
<li>When prompted enter <code>f</code> for file input</li>
<li>Input file should be named <code>input.txt</code></li>
<li>File should be saved in the app root directory</li>
<li>File should contain one URL on each line</li>
</ul>
<h2>Source Code</h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time

<span class="token keyword">import</span> img2pdf
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

mode <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Single URL (u) or file input (f)? '</span><span class="token punctuation">)</span>
keep_going <span class="token operator">=</span> <span class="token boolean">True</span>
input_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
proceed <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">while</span> keep_going<span class="token punctuation">:</span>
    <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'u'</span><span class="token punctuation">:</span>
        input_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'What is the URL? '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">elif</span> mode <span class="token operator">==</span> <span class="token string">'f'</span><span class="token punctuation">:</span>
        input_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
        file_data <span class="token operator">=</span> input_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        input_list <span class="token operator">=</span> file_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> url <span class="token keyword">in</span> input_list<span class="token punctuation">:</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) '</span>
                          <span class="token string">'Chrome/96.0.4664.110 Safari/537.36'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span>
        <span class="token punctuation">}</span>
        url_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
        <span class="token keyword">if</span> url_response<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch webpage'</span><span class="token punctuation">)</span>
            <span class="token comment"># Uncomment any/all of the below lines for help troubleshooting fetch failure</span>
            <span class="token comment"># print('Response Status Code: ', url_response.status_code)</span>
            <span class="token comment"># print('Response Content: ', url_response.text)</span>
            <span class="token comment"># print('Final URL after redirects: ', url_response.url)</span>
            <span class="token comment"># print('Request Headers: ', url_response.request.headers)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>url_response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
            initial_data <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'initial-data'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> initial_data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initial-data script tag not found'</span><span class="token punctuation">)</span>
            json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>initial_data<span class="token punctuation">[</span><span class="token string">'data-json'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            revision_id <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">'initialDocumentData'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'document'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'revisionId'</span><span class="token punctuation">]</span>
            publication_id <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">'initialDocumentData'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'document'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'publicationId'</span><span class="token punctuation">]</span>
            title <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">'initialDocumentData'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'document'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
            total_pages <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>json_data<span class="token punctuation">[</span><span class="token string">'initialDocumentData'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'document'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pageCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            base_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://image.isu.pub/</span><span class="token interpolation"><span class="token punctuation">{</span>revision_id<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span>publication_id<span class="token punctuation">}</span></span><span class="token string">/jpg/page_'</span></span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Processing </span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">: '</span></span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> total_pages <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                img_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> img_response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>page<span class="token punctuation">}</span></span><span class="token string">.jpg'</span></span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> page <span class="token operator">==</span> total_pages<span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'failed to download page </span><span class="token interpolation"><span class="token punctuation">{</span>page<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
            images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> file_name <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># for file_name in os.listdir(title):</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> file_name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>title<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'completed'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">'completed'</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'completed/</span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">.pdf'</span></span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>img2pdf<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
                <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error: %s : %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>strerror<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">"f"</span><span class="token punctuation">:</span>
            keep_going <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">"u"</span><span class="token punctuation">:</span>
            proceed <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Do you have another document to process? (y or n) '</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> proceed <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
                keep_going <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Completed."</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># Pause for 3 seconds</span>
sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

</article>
<nav>
    
</nav>
<br/>
  </body>
</html>