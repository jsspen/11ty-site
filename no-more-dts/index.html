<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preload" href="/styles.css" as="style" onload="this.rel='stylesheet'">
    <noscript>
      <link rel="stylesheet" href="/styles.css">
    </noscript>
    <link rel="stylesheet" href="/prism-vsc-dark-plus.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wdth,wght@8..144,25..151,100..1000&display=swap" rel="stylesheet">
    <title>No More DTS</title>
  </head>
  <body>
    <h1>jordan spencer</h1>
    <header>
      <nav><a href="/">home</a> | <a href="/about">about</a> | <a href="/projects">projects</a> | <a href="/writing">writing</a> | <a href="/cv">cv</a> | <a href="/other-projects">other projects</a></nav>
    </header>
    
<article>
    <h1>NoMoreDTS</h1>
<p><a href="https://github.com/jsspen/NoMoreDTS">GitHub Repo</a></p>
<p>An interactive CLI program to handle audio conversion of video files with FFMPEG</p>
<p><strong>Ingredients:</strong> Python, FFMPEG, File I/O, File Conversion</p>
<p><em><em>Why?</em></em> I have a television that cannot direct play DTS encoded audio (or FLAC) and my little Raspberry Pi can get really bogged down trying to transcode audio on the fly. I had previously encoded many of my files with DTS audio without realizing the limitations of my (admittedly quite old) TV. I've got years with of archived video and when I go to watch something and my media player shows &quot;DTS Audio&quot; my whole family groans. There's nothing at all wrong with DTS (or FLAC) and I wish I could play them... but for now I need to convert them.</p>
<hr>
<h2>Basic usage</h2>
<ul>
<li>Clone or download repo</li>
<li>Open terminal in root directory</li>
<li>Update base path values in the code</li>
<li>Run the program with <code>python NoMoreDTS.py</code></li>
</ul>
<h3>Manual Entry</h3>
<p>Provide the necessary information to process a single file. This option also allows for customizing the base path and the FFMPEG command used for processing.</p>
<ul>
<li>When prompted enter <code>m</code> for manual entry</li>
<li>Default base paths are hardcoded on lines 34 &amp; 35, make sure to update these with the relevant values for your useage.</li>
<li>Provide a destination path, meaning the name of the directory where the converted file should be saved. This will be combined with the <code>OUTPUT_BASE</code> (whether pre-defined or set during run) to ensure the directory exists before the conversion process begins.</li>
<li>Provide the input path, including file extension. This will be combined with the <code>INPUT_BASE</code> (whether pre-defined or set during run) to create the full input path passed to FFMPEG. If the <code>INPUT_BASE</code> value is set to the root directory of the file then only the filename and extension need to be entered here but it will also accept any amount of nested directories, too.</li>
<li>Provide the output filename desired.</li>
<li>Decide on using the default FFMPEG command or something else</li>
<li>Process!</li>
</ul>
<h3>File Entry</h3>
<p>A CSV file can be passed to process multiple files</p>
<ul>
<li>When prompted enter <code>c</code> for file input</li>
<li>File should be saved in the app root directory</li>
<li>Program expects the first row of the file to be a labeled header row with the three columns: <code>OUTPUT_DIRECTORY</code>, <code>INPUT_FILE_PATH</code>, and <code>OUTPUT_FILENAME</code>.</li>
<li>This will always process the files using the same FFMPEG command, though you are given the option to use a custom command.</li>
</ul>
<h2>Source Code</h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> csv

<span class="token comment"># create directory if it doesn't exist</span>
<span class="token keyword">def</span> <span class="token function">create_directory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Created directory: </span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Directory already exists: </span><span class="token interpolation"><span class="token punctuation">{</span>path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># run the ffmpeg command</span>
<span class="token keyword">def</span> <span class="token function">run_ffmpeg</span><span class="token punctuation">(</span>INPUT_PATH<span class="token punctuation">,</span> FULL_OUTPUT<span class="token punctuation">,</span> FFMPEG_COMMAND<span class="token punctuation">)</span><span class="token punctuation">:</span>
    command <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"ffmpeg"</span><span class="token punctuation">,</span>
        <span class="token string">"-i"</span><span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span>
        <span class="token operator">*</span>FFMPEG_COMMAND<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        FULL_OUTPUT
    <span class="token punctuation">]</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>command<span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Conversion successful! File saved at: </span><span class="token interpolation"><span class="token punctuation">{</span>FULL_OUTPUT<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> subprocess<span class="token punctuation">.</span>CalledProcessError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error during conversion: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># take user input rather than csv file</span>
<span class="token keyword">def</span> <span class="token function">manual_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Manual input mode</span>
    USE_DEFAULT_PATHS <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Do you want to use the default base paths? (y/n) '</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> USE_DEFAULT_PATHS <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
        <span class="token comment"># set by default</span>
        INPUT_BASE <span class="token operator">=</span> <span class="token string">'/hardcoded/path/to/input/'</span>
        OUTPUT_BASE <span class="token operator">=</span> <span class="token string">'/hardcoded/path/to/destination/'</span>
        <span class="token comment"># file specific input</span>
        OUTPUT_DIRECTORY <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Destination path: </span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_BASE<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        INPUT_FILE_PATH <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Current path (including extension): </span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_BASE<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        OUTPUT_FILENAME <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Output filename? '</span><span class="token punctuation">)</span>
        <span class="token comment"># combining default &amp; input</span>
        <span class="token comment"># output base + output directory = path for creating output directory if it doesn't exist</span>
        OUTPUT_PATH <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_BASE<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_DIRECTORY<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token comment"># input base + input path = ffmpeg input</span>
        INPUT_PATH <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_BASE<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_FILE_PATH<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token comment"># output path + output filename = ffmpeg output</span>
        FULL_OUTPUT <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_PATH<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_FILENAME<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token comment"># check</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Creating: </span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_PATH<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Processing: </span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_PATH<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Outputting: </span><span class="token interpolation"><span class="token punctuation">{</span>FULL_OUTPUT<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token comment">####### TO DO #######</span>
        <span class="token comment"># correct = input('Is this correct?')</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        OUTPUT_PATH <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Enter the full path for the final destination directory: '</span><span class="token punctuation">)</span>
        INPUT_PATH <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Enter the full path for the current file, including extension: '</span><span class="token punctuation">)</span>
        OUTPUT_FILENAME <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'What is the desired final filename? '</span><span class="token punctuation">)</span>
        FULL_OUTPUT <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_PATH<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_FILENAME<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Creating: </span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_PATH<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Processing: </span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_PATH<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Outputting: </span><span class="token interpolation"><span class="token punctuation">{</span>FULL_OUTPUT<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token comment">####### TO DO #######</span>
        <span class="token comment"># correct = input('Is this correct?')</span>

    <span class="token comment"># Give option to change command or use default</span>
    FFMPEG_COMMAND <span class="token operator">=</span> set_FFMPEG_COMMAND<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># FFMPEG doesn't like if the output directory doesn't exist yet</span>
    create_directory<span class="token punctuation">(</span>OUTPUT_PATH<span class="token punctuation">)</span>
    <span class="token comment"># Run the ffmpeg conversion</span>
    run_ffmpeg<span class="token punctuation">(</span>INPUT_PATH<span class="token punctuation">,</span> FULL_OUTPUT<span class="token punctuation">,</span> FFMPEG_COMMAND<span class="token punctuation">)</span>

<span class="token comment"># Take a csv file as input</span>
<span class="token comment"># currently accepts header row with</span>
<span class="token comment"># OUTPUT_DIRECTORY, INPUT_FILE_PATH, OUTPUT_FILENAME</span>
<span class="token keyword">def</span> <span class="token function">csv_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    CSV_FILE <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Enter the name of the CSV file: '</span><span class="token punctuation">)</span>
    <span class="token comment"># Get command outside of the loop so you don't have to keep answering</span>
    <span class="token comment"># Assumes you're going to use the same command for batch processing</span>
    FFMPEG_COMMAND <span class="token operator">=</span> set_FFMPEG_COMMAND<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>CSV_FILE<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
            <span class="token comment"># Skip first (header) row</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
                OUTPUT_DIRECTORY<span class="token punctuation">,</span> INPUT_FILE_PATH<span class="token punctuation">,</span> OUTPUT_FILENAME <span class="token operator">=</span> row
                <span class="token comment"># Currently using a default base path</span>
                OUTPUT_PATH <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"/hardcoded/path/to/destination/</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_DIRECTORY<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                INPUT_PATH <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"/hardcoded/path/to/input/</span><span class="token interpolation"><span class="token punctuation">{</span>INPUT_FILE_PATH<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                FULL_OUTPUT <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_PATH<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>OUTPUT_FILENAME<span class="token punctuation">}</span></span><span class="token string">"</span></span>

                <span class="token comment"># Create destination directory</span>
                create_directory<span class="token punctuation">(</span>OUTPUT_PATH<span class="token punctuation">)</span>
                <span class="token comment"># Run the ffmpeg conversion</span>
                run_ffmpeg<span class="token punctuation">(</span>INPUT_PATH<span class="token punctuation">,</span> FULL_OUTPUT<span class="token punctuation">,</span> FFMPEG_COMMAND<span class="token punctuation">)</span>

    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error: CSV file '</span><span class="token interpolation"><span class="token punctuation">{</span>CSV_FILE<span class="token punctuation">}</span></span><span class="token string">' not found."</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">set_FFMPEG_COMMAND</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    FFMPEG_COMMAND <span class="token operator">=</span> <span class="token string">"-map 0 -c:v copy -c:a ac3 -b:a 640k -c:s copy"</span>
    USE_DEFAULT_COMMAND <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Do you want to use the default command: </span><span class="token interpolation"><span class="token punctuation">{</span>FFMPEG_COMMAND<span class="token punctuation">}</span></span><span class="token string">? (y/n) '</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> USE_DEFAULT_COMMAND <span class="token operator">!=</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
        FFMPEG_COMMAND <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Enter the desired command: '</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> FFMPEG_COMMAND

<span class="token comment"># Select input type</span>
<span class="token comment"># csv file must be in root directory</span>
INPUT_TYPE <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Enter \'c\' for csv input or \'m\' for manual: '</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span> INPUT_TYPE <span class="token operator">==</span> <span class="token string">'c'</span><span class="token punctuation">:</span>
    csv_input<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> INPUT_TYPE <span class="token operator">==</span> <span class="token string">'m'</span><span class="token punctuation">:</span>
    manual_input<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

</article>
<nav>
    
</nav>
<br/>
  </body>
</html>